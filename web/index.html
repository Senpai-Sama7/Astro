<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <meta name="description" content="ASTRO - Autonomous Agent Ecosystem. Orchestrate AI research, code, and workflows from one unified interface." />
    <meta name="theme-color" content="#050507" />
    <title>ASTRO ¬∑ Autonomous Agent Console</title>
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link href="https://fonts.googleapis.com/css2?family=Space+Grotesk:wght@400;500;600;700&family=IBM+Plex+Mono:wght@400;500&family=Inter:wght@400;500;600&display=swap" rel="stylesheet" />
    <link rel="stylesheet" href="styles.css" />
  </head>
  <body>
    <div class="grain"></div>

    <header class="hero">
      <div class="hero__brand">
        <span class="mark">ASTRO</span>
        <span class="badge" id="status-badge">Checking...</span>
      </div>

      <div class="hero__copy">
        <p class="eyebrow">Autonomous Multi-Agent System</p>
        <h1>Your AI team that actually gets things done.</h1>
        <p>Deploy and orchestrate AI agents for research, code generation, file management, testing, and more‚Äîall from natural language commands.</p>
      </div>

      <div class="hero__cta">
        <a href="chat.html" class="btn btn--primary">
          <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <path d="M21 15a2 2 0 0 1-2 2H7l-4 4V5a2 2 0 0 1 2-2h14a2 2 0 0 1 2 2z"/>
          </svg>
          Start Chatting
        </a>
        <button class="btn btn--ghost" id="deploy-btn">
          <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <polygon points="13 2 3 14 12 14 11 22 21 10 12 10 13 2"/>
          </svg>
          <span id="deploy-text">Deploy Agents</span>
        </button>
      </div>

      <dl class="hero__stats">
        <div>
          <dt>Agents Available</dt>
          <dd id="stat-agents">7</dd>
        </div>
        <div>
          <dt>Tests Passing</dt>
          <dd>21/21</dd>
        </div>
        <div>
          <dt>System Status</dt>
          <dd id="system-status">
            <span class="status-dot" id="status-dot"></span>
            <span id="status-text">Checking...</span>
          </dd>
        </div>
      </dl>
    </header>

    <section class="access-grid">
      <header>
        <p class="eyebrow">Access Points</p>
        <h2>Choose your interface</h2>
        <p>Jump into conversational AI, orchestrate complex workflows, manage your knowledge base, or browse generated files.</p>
      </header>

      <div class="access-grid__cards">
        <article class="access-card">
          <div class="access-card__meta">
            <span class="tag">AI Assistant</span>
            <span class="version">v2.0</span>
          </div>
          <h3>üí¨ Chat Interface</h3>
          <p>Natural language conversations with your AI team. Research, write, code, and analyze without technical knowledge.</p>
          <a href="chat.html" class="btn btn--ghost">Start chatting</a>
        </article>

        <article class="access-card">
          <div class="access-card__meta">
            <span class="tag">API</span>
            <span class="version">REST</span>
          </div>
          <h3>üîå API Access</h3>
          <p>Integrate ASTRO into your applications via REST API. Full documentation and WebSocket support included.</p>
          <a href="/docs" class="btn btn--ghost" target="_blank">View API Docs</a>
        </article>

        <article class="access-card">
          <div class="access-card__meta">
            <span class="tag">Desktop</span>
            <span class="version">GUI</span>
          </div>
          <h3>üñ•Ô∏è Desktop App</h3>
          <p>Native desktop application with full agent control, real-time monitoring, and offline capabilities.</p>
          <a href="https://github.com/Senpai-Sama7/Astro/releases" class="btn btn--ghost" target="_blank">Download</a>
        </article>

        <article class="access-card">
          <div class="access-card__meta">
            <span class="tag">Source</span>
            <span class="version">MIT</span>
          </div>
          <h3>üì¶ GitHub</h3>
          <p>Open source under MIT license. Star, fork, contribute, or self-host your own ASTRO instance.</p>
          <a href="https://github.com/Senpai-Sama7/Astro" class="btn btn--ghost" target="_blank">View Source</a>
        </article>
      </div>
    </section>

    <section class="access-grid">
      <header>
        <p class="eyebrow">Agent Fleet</p>
        <h2>7 specialized agents at your command</h2>
        <p>Each agent is purpose-built for specific tasks, working together seamlessly to accomplish complex goals.</p>
      </header>

      <div class="agent-grid" id="agent-grid">
        <!-- Agents will be populated dynamically -->
      </div>
    </section>

    <section class="access-grid">
      <header>
        <p class="eyebrow">Live Telemetry</p>
        <h2>System performance</h2>
      </header>

      <div class="telemetry">
        <div class="telemetry__item">
          <div class="telemetry__value" id="tel-agents">--</div>
          <div class="telemetry__label">Active Agents</div>
        </div>
        <div class="telemetry__item">
          <div class="telemetry__value" id="tel-tasks">--</div>
          <div class="telemetry__label">Tasks Queued</div>
        </div>
        <div class="telemetry__item">
          <div class="telemetry__value" id="tel-latency">--</div>
          <div class="telemetry__label">Avg Latency</div>
        </div>
        <div class="telemetry__item">
          <div class="telemetry__value" id="tel-uptime">--</div>
          <div class="telemetry__label">Uptime</div>
        </div>
      </div>
    </section>

    <style>
      .status-dot {
        display: inline-block;
        width: 8px;
        height: 8px;
        border-radius: 50%;
        margin-right: 6px;
        background: var(--muted, #6b7280);
      }
      .status-dot.online { background: #22c55e; box-shadow: 0 0 8px #22c55e; }
      .status-dot.offline { background: #6b7280; }
      .status-dot.error { background: #ef4444; }
      .agent-card__status { display: flex; align-items: center; gap: 6px; font-size: 0.75rem; color: var(--muted, #a1a1aa); }
      .agent-card__status::before {
        content: "";
        width: 6px;
        height: 6px;
        border-radius: 50%;
        background: #22c55e;
      }
      .agent-card__status.offline::before { background: #6b7280; }
      @keyframes spin { to { transform: rotate(360deg); } }
      .loading { display: inline-block; width: 14px; height: 14px; border: 2px solid transparent; border-top-color: currentColor; border-radius: 50%; animation: spin 0.8s linear infinite; }
    </style>

    <script>
      // Agent icons mapping
      const AGENT_ICONS = {
        'research-agent': 'üî¨',
        'code-agent': 'üíª',
        'filesystem-agent': 'üìÅ',
        'git-agent': 'üîß',
        'test-agent': 'üß™',
        'analysis-agent': 'üìä',
        'knowledge-agent': 'üß†',
        'general-assistant': 'ü§ñ',
        'math-agent': 'üî¢',
        'echo-agent': 'üì¢',
      };

      // State
      let systemOnline = false;
      let agentStatuses = {};
      let AGENTS = [];
      let startTime = Date.now();
      let authToken = null;

      // Get auth token
      async function getToken() {
        if (authToken) return authToken;
        try {
          const res = await fetch('http://localhost:5000/api/v1/auth/dev-token', {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify({ userId: 'web-user', role: 'admin' })
          });
          const data = await res.json();
          authToken = data.token;
          return authToken;
        } catch (e) {
          return null;
        }
      }

      // Render agents
      function renderAgents() {
        const grid = document.getElementById('agent-grid');
        grid.innerHTML = AGENTS.map(agent => `
          <div class="agent-card" data-agent="${agent.id}">
            <div class="agent-card__header">
              <div class="agent-card__icon">${AGENT_ICONS[agent.id] || 'ü§ñ'}</div>
              <div>
                <h3>${agent.name}</h3>
                <div class="agent-card__status ${agentStatuses[agent.id] ? '' : 'offline'}" id="status-${agent.id}">
                  ${agentStatuses[agent.id] ? 'Online' : 'Offline'}
                </div>
              </div>
            </div>
            <p>${agent.description}</p>
            <div style="margin-top: 8px; font-size: 0.75rem; color: var(--muted);">
              Tools: ${agent.tools?.join(', ') || 'none'}
            </div>
          </div>
        `).join('');
      }

      // Check system status
      async function checkStatus() {
        const statusDot = document.getElementById('status-dot');
        const statusText = document.getElementById('status-text');
        const statusBadge = document.getElementById('status-badge');

        try {
          const res = await fetch('http://localhost:5000/api/v1/health');
          if (res.ok) {
            const data = await res.json();
            systemOnline = true;
            statusDot.className = 'status-dot online';
            statusText.textContent = 'Online';
            statusBadge.textContent = 'Production Ready';
            statusBadge.style.background = 'rgba(34, 197, 94, 0.2)';
            statusBadge.style.borderColor = '#22c55e';

            // Fetch real agents from API
            const token = await getToken();
            if (token) {
              const agentsRes = await fetch('http://localhost:5000/api/v1/astro/agents', {
                headers: { 'Authorization': `Bearer ${token}` }
              });
              if (agentsRes.ok) {
                const agentsData = await agentsRes.json();
                AGENTS = agentsData.agents || [];
                AGENTS.forEach(a => agentStatuses[a.id] = true);
              }
            }

            // Update telemetry
            document.getElementById('tel-agents').textContent = AGENTS.length;
            document.getElementById('tel-tasks').textContent = 0;
            document.getElementById('tel-latency').textContent = '<50ms';
            document.getElementById('stat-agents').textContent = AGENTS.length;

            renderAgents();
            return true;
          }
        } catch (e) {
          // Server not running - show offline state
        }

        systemOnline = false;
        statusDot.className = 'status-dot offline';
        statusText.textContent = 'Offline';
        statusBadge.textContent = 'Server Offline';
        statusBadge.style.background = 'rgba(107, 114, 128, 0.2)';
        statusBadge.style.borderColor = '#6b7280';

        // All agents offline
        AGENTS.forEach(a => agentStatuses[a.id] = false);
        document.getElementById('tel-agents').textContent = '0';
        document.getElementById('tel-tasks').textContent = '--';
        document.getElementById('tel-latency').textContent = '--';
        document.getElementById('stat-agents').textContent = '0';

        renderAgents();
        return false;
      }

      // Update uptime
      function updateUptime() {
        if (!systemOnline) {
          document.getElementById('tel-uptime').textContent = '--';
          return;
        }
        const elapsed = Math.floor((Date.now() - startTime) / 1000);
        const hours = Math.floor(elapsed / 3600);
        const mins = Math.floor((elapsed % 3600) / 60);
        const secs = elapsed % 60;

        if (hours > 0) {
          document.getElementById('tel-uptime').textContent = `${hours}h ${mins}m`;
        } else if (mins > 0) {
          document.getElementById('tel-uptime').textContent = `${mins}m ${secs}s`;
        } else {
          document.getElementById('tel-uptime').textContent = `${secs}s`;
        }
      }

      // Deploy button
      document.getElementById('deploy-btn').addEventListener('click', async () => {
        const btn = document.getElementById('deploy-btn');
        const text = document.getElementById('deploy-text');

        btn.disabled = true;
        text.innerHTML = '<span class="loading"></span> Starting...';

        try {
          const res = await fetch('/api/system/start', { method: 'POST' });
          if (res.ok) {
            text.textContent = '‚úì System Started';
            startTime = Date.now();
            await checkStatus();
            setTimeout(() => {
              text.textContent = 'Deploy Agents';
              btn.disabled = false;
            }, 2000);
          } else {
            throw new Error('Failed to start');
          }
        } catch (e) {
          text.textContent = '‚úó Server Unavailable';
          setTimeout(() => {
            text.textContent = 'Deploy Agents';
            btn.disabled = false;
          }, 2000);
        }
      });

      // Initialize
      renderAgents();
      checkStatus();
      setInterval(checkStatus, 10000); // Check every 10s
      setInterval(updateUptime, 1000); // Update uptime every second
    </script>
  </body>
</html>
